<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Worst-Case Runtime Simulator *ScopedLabs</title>

  <link rel="stylesheet" href="/assets/style.css?v=power-pro-003" />
  <script src="/assets/app.js?v=power-pro-003" defer></script>
</head>
<body data-protected="true" data-tier="pro">
  <header class="site-header">
    <div class="container header-inner">
      <a class="brand" href="/">
        <span class="brand-mark" aria-hidden="true"></span>
        <span class="brand-name">ScopedLabs</span>
      </a>

      <nav class="nav">
        <a class="nav-link" href="/">Home</a>
        <a class="nav-link" href="/tools/" aria-current="page">Tools</a>
        <a class="nav-link" href="/about/">About</a>
      </nav>
    </div>
  </header>

  <main class="page">
    <div class="container">
      <div class="breadcrumbs muted">
        <a href="/tools/">Tools</a> <span class="muted">/</span>
        <a href="/tools/power/">Power &amp; Runtime</a> <span class="muted">/</span>
        <span>Worst-Case Runtime Simulator</span>
      </div>

      <h1 class="page-title">Worst-Case Runtime Simulator</h1>
      <p class="page-subtitle">
        Stress-test assumptions and see runtime under worst-case conditions.
      </p>

      <div class="card info-card">
        <p class="muted">
          Pro tool planned: simulate cold battery performance, aging derate, inverter efficiency drop,
          and load spikes Ã¢â‚¬â€ then show the Ã¢â‚¬Å“bad dayÃ¢â‚¬Â runtime so you can size with real headroom.
        </p>
      </div>

      <!-- =========================
           LOCKED GATE (default)
           ========================= -->
      <section id="lockedCard" class="card tool-card locked-card" aria-label="Pro tool locked">
        <div class="pill-row">
          <span class="pill pro">Pro / Advanced</span>
        </div>

        <h2 class="tool-title">Ã°Å¸â€â€™ Locked</h2>
        <p class="tool-desc">
          This advanced simulator is included with Pro access for the Power &amp; Runtime category.
        </p>

        <div class="locked-box">
          <div class="locked-row">
            <div class="locked-label">Worst-case factors modeled</div>
            <ul class="locked-list">
              <li>Battery age / health derate curves</li>
              <li>Temperature impact (cold room / hot closet)</li>
              <li>Peak spike multiplier (start-up surges)</li>
              <li>Runtime floor targets (minutes) + pass/fail</li>
            </ul>
          </div>
        </div>

        <div class="btn-row">
          <a class="btn" href="/tools/power/">Back to Power &amp; Runtime</a>
          <a class="btn primary" href="/upgrade/?category=power">
            Unlock Pro for Power &amp; Runtime
          </a>
        </div>

        <div class="spacer-md"></div>
        <div class="muted" style="font-size:.85rem; opacity:.85;">
          Dev unlock: add <code>?pro=1</code> to the URL, or set <code>localStorage.scopedlabs_pro_power="1"</code>.
        </div>
      </section>

      <!-- =========================
           UNLOCKED TOOL (hidden until unlocked)
           ========================= -->
      <section id="toolCard" class="card tool-card" style="display:none;" aria-label="Worst-Case Runtime Simulator tool">
        <div class="pill-row">
          <span class="pill pro">Pro / Advanced</span>
        </div>

        <h2 class="tool-title">Worst-Case Runtime Simulator</h2>
        <p class="tool-desc">
          Planning-grade runtime math using energy (Wh) and explicit derates. No hidden assumptions.
        </p>

        <div class="spacer-md"></div>

        <!-- INPUTS -->
        <div class="card" style="background:rgba(0,0,0,.16);">
          <div style="display:grid; grid-template-columns: 1fr; gap: 1rem;">

            <div class="muted" style="font-size:.95rem;">
              <strong>Baseline</strong> (what you expect on a normal day)
            </div>

            <div style="display:grid; grid-template-columns: repeat(auto-fit,minmax(220px,1fr)); gap: 1rem;">
              <label class="muted">
                Load (Watts)
                <input id="loadW" type="number" min="0" step="1" value="200" />
              </label>

              <label class="muted">
                UPS Rated Output (Watts)
                <input id="upsMaxW" type="number" min="1" step="1" value="450" />
              </label>

              <label class="muted">
                Usable Battery Energy (Wh)
                <input id="usableWh" type="number" min="1" step="1" value="360" />
              </label>

              <label class="muted">
                Inverter Efficiency (%)
                <input id="effPct" type="number" min="50" max="99" step="1" value="90" />
              </label>
            </div>

            <div class="muted" style="font-size:.95rem;">
              <strong>Worst-case derates</strong> (explicit penalties)
            </div>

            <div style="display:grid; grid-template-columns: repeat(auto-fit,minmax(220px,1fr)); gap: 1rem;">
              <label class="muted">
                Battery Health Derate (% loss)
                <input id="healthLossPct" type="number" min="0" max="70" step="1" value="15" />
              </label>

              <label class="muted">
                Temperature Derate (% loss)
                <input id="tempLossPct" type="number" min="0" max="60" step="1" value="10" />
              </label>

              <label class="muted">
                Load Spike Multiplier (x)
                <input id="spikeX" type="number" min="1" max="3" step="0.01" value="1.20" />
              </label>

              <label class="muted">
                Runtime Floor Target (minutes)
                <input id="floorMin" type="number" min="0" step="1" value="20" />
              </label>
            </div>

            <div class="muted" style="font-size:.9rem; opacity:.9; line-height:1.45;">
              Model used: <strong>runtime = (usableWh Ãƒâ€” efficiency Ãƒâ€” derates) ÃƒÂ· (loadW Ãƒâ€” spike)</strong>.
              This is planning-grade energy math. If you donÃ¢â‚¬â„¢t know usableWh, use a known runtime point to back-calculate later.
            </div>

            <div class="btn-row">
              <button id="calc" class="btn primary" type="button">Run Worst-Case</button>
              <button id="reset" class="btn" type="button">Reset</button>
              <a class="btn" href="/tools/power/">Back to Power &amp; Runtime</a>
            </div>
          </div>
        </div>

        <div class="spacer-md"></div>

        <!-- OUTPUT -->
        <div id="outWrap" class="card" style="background:rgba(0,0,0,.12);">
          <div class="muted" style="font-size:.95rem;">
            Run the simulator to see baseline vs worst-case runtime and pass/fail against the floor target.
          </div>
        </div>

        <div class="spacer-md"></div>

        <div class="btn-row">
          <a class="btn" href="/upgrade/?category=power">Upgrade / Manage Pro</a>
        </div>
      </section>

      <div class="spacer-xl"></div>

      <footer class="site-footer muted">
        Ã‚Â© <span data-year></span> ScopedLabs
      </footer>
    </div>
  </main>

  <script>
    (function () {
      // Pro gate: URL ?pro=1 OR localStorage scopedlabs_pro_power="1"
      const params = new URLSearchParams(window.location.search);
      const unlocked = (params.get("pro") === "1") || (localStorage.getItem("scopedlabs_pro_power") === "1");

      const lockedCard = document.getElementById("lockedCard");
      const toolCard = document.getElementById("toolCard");
      if (unlocked) {
        lockedCard.style.display = "none";
        toolCard.style.display = "";
      }

      // Year
      const y = document.querySelector("[data-year]");
      if (y) y.textContent = new Date().getFullYear();

      function n(id) {
        const el = document.getElementById(id);
        const v = Number(el.value);
        return Number.isFinite(v) ? v : 0;
      }

      function clamp(v, min, max) {
        return Math.max(min, Math.min(max, v));
      }

      function fmt(num, digits = 1) {
        return Number.isFinite(num) ? num.toFixed(digits) : "Ã¢â‚¬â€";
      }

      function minutesFromWh(usableWh, effPct, healthLossPct, tempLossPct, loadW, spikeX) {
        const eff = clamp(effPct, 50, 99) / 100;
        const healthMult = 1 - clamp(healthLossPct, 0, 70) / 100;
        const tempMult = 1 - clamp(tempLossPct, 0, 60) / 100;
        const derateMult = healthMult * tempMult;

        const effectiveWh = Math.max(0, usableWh) * eff * derateMult;
        const denomW = Math.max(1, loadW) * Math.max(1, spikeX);

        const hours = effectiveWh / denomW;
        return hours * 60;
      }

      function run() {
        const loadW = Math.max(0, n("loadW"));
        const upsMaxW = Math.max(1, n("upsMaxW"));
        const usableWh = Math.max(1, n("usableWh"));
        const effPct = clamp(n("effPct"), 50, 99);

        const healthLossPct = clamp(n("healthLossPct"), 0, 70);
        const tempLossPct = clamp(n("tempLossPct"), 0, 60);
        const spikeX = clamp(n("spikeX"), 1, 3);
        const floorMin = Math.max(0, n("floorMin"));

        const overloadNominal = loadW > upsMaxW;
        const overloadWorst = (loadW * spikeX) > upsMaxW;

        // Baseline runtime: derates off, spike=1
        const baselineMin = minutesFromWh(usableWh, effPct, 0, 0, loadW, 1);

        // Worst-case runtime: derates applied, spike applied
        const worstMin = minutesFromWh(usableWh, effPct, healthLossPct, tempLossPct, loadW, spikeX);

        const passWorst = worstMin >= floorMin && !overloadWorst;

        const out = document.getElementById("outWrap");

        const badge = passWorst ? "Ã¢Å“â€¦ PASS" : "Ã¢Å¡Â  FAIL";
        const overloadLine = overloadWorst
          ? `Ã¢Å¡Â  Spike load exceeds UPS rating: <strong>${fmt(loadW * spikeX,0)}W</strong> > <strong>${fmt(upsMaxW,0)}W</strong>`
          : `Ã¢Å“â€¦ Spike load within UPS rating: <strong>${fmt(loadW * spikeX,0)}W</strong> Ã¢â€°Â¤ <strong>${fmt(upsMaxW,0)}W</strong>`;

        const floorLine = (worstMin >= floorMin)
          ? `Ã¢Å“â€¦ Worst-case runtime meets floor: <strong>${fmt(worstMin,1)} min</strong> Ã¢â€°Â¥ <strong>${fmt(floorMin,0)} min</strong>`
          : `Ã¢Å¡Â  Worst-case runtime below floor: <strong>${fmt(worstMin,1)} min</strong> < <strong>${fmt(floorMin,0)} min</strong>`;

        out.innerHTML = `
          <div style="display:flex; flex-wrap:wrap; gap:.6rem; align-items:center;">
            <span class="pill">Load: ${fmt(loadW,0)}W</span>
            <span class="pill">UPS max: ${fmt(upsMaxW,0)}W</span>
            <span class="pill">Usable: ${fmt(usableWh,0)}Wh</span>
            <span class="pill">Eff: ${fmt(effPct,0)}%</span>
            <span class="pill">Health: -${fmt(healthLossPct,0)}%</span>
            <span class="pill">Temp: -${fmt(tempLossPct,0)}%</span>
            <span class="pill">Spike: x${fmt(spikeX,2)}</span>
            <span class="pill">Floor: ${fmt(floorMin,0)}m</span>
          </div>

          <div class="spacer-md"></div>

          <div class="muted" style="font-size:1rem; line-height:1.55;">
            <div><strong>${badge}</strong> Ã¢â‚¬â€ Worst-case planning result</div>
            <div class="spacer-sm"></div>
            <div>Baseline runtime (no derates): <strong>${fmt(baselineMin,1)} min</strong></div>
            <div>Worst-case runtime: <strong>${fmt(worstMin,1)} min</strong></div>
          </div>

          <div class="spacer-md"></div>

          <div class="card" style="background:rgba(0,0,0,.14);">
            <div class="muted" style="line-height:1.55;">
              <div>${overloadLine}</div>
              <div>${floorLine}</div>
            </div>
          </div>

          <div class="spacer-md"></div>

          <div class="muted" style="font-size:.95rem; line-height:1.5;">
            Planning notes:
            <ul style="margin:.4rem 0 0 1.15rem;">
              <li>Derates reduce usable energy (Wh). Spike increases load demand (W). Both reduce runtime.</li>
              <li>If you donÃ¢â‚¬â„¢t know usable Wh, you can back-calc it from a known runtime point later.</li>
              <li>Always size with margin for battery aging and environment (closets run hot, basements run cold).</li>
            </ul>
          </div>
        `;
      }

      function reset() {
        document.getElementById("loadW").value = "200";
        document.getElementById("upsMaxW").value = "450";
        document.getElementById("usableWh").value = "360";
        document.getElementById("effPct").value = "90";
        document.getElementById("healthLossPct").value = "15";
        document.getElementById("tempLossPct").value = "10";
        document.getElementById("spikeX").value = "1.20";
        document.getElementById("floorMin").value = "20";

        document.getElementById("outWrap").innerHTML =
          '<div class="muted" style="font-size:.95rem;">Run the simulator to see baseline vs worst-case runtime and pass/fail against the floor target.</div>';
      }

      const calcBtn = document.getElementById("calc");
      const resetBtn = document.getElementById("reset");
      if (calcBtn) calcBtn.addEventListener("click", run);
      if (resetBtn) resetBtn.addEventListener("click", reset);
    })();
  </script>
<script src="/assets/pro.js?v=0207"></script>
</body>
</html>


